# è¿ç§»åˆ° uv æŒ‡å—

## ğŸ“¦ ä»€ä¹ˆæ˜¯ uvï¼Ÿ

`uv` æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„æé€Ÿ Python åŒ…ç®¡ç†å™¨å’Œé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œç”± Astralï¼ˆRuff çš„åˆ›å»ºè€…ï¼‰å¼€å‘ã€‚

### ä¸»è¦ä¼˜åŠ¿

| ç‰¹æ€§ | uv | pip + venv |
|------|----|-----------| 
| **å®‰è£…é€Ÿåº¦** | âš¡ 10-100x å¿« | ğŸŒ æ…¢ |
| **ä¾èµ–è§£æ** | ğŸš€ Rust å®ç° | ğŸ Python å®ç° |
| **è™šæ‹Ÿç¯å¢ƒ** | ğŸ¯ è‡ªåŠ¨ç®¡ç† | ğŸ”§ æ‰‹åŠ¨åˆ›å»º |
| **é”æ–‡ä»¶** | âœ… `uv.lock` | âŒ éœ€è¦é¢å¤–å·¥å…· |
| **è·¨å¹³å°** | âœ… ä¸€è‡´æ€§å¥½ | âš ï¸ å¯èƒ½æœ‰å·®å¼‚ |
| **ç¼“å­˜** | âœ… å…¨å±€ç¼“å­˜ | âŒ æ¯æ¬¡ä¸‹è½½ |
| **ç£ç›˜å ç”¨** | ğŸ’¾ å…±äº«ç¼“å­˜ | ğŸ’½ é‡å¤å®‰è£… |

---

## ğŸ”„ å·²å®Œæˆçš„è¿ç§»å·¥ä½œ

### 1. åˆ›å»ºäº† `pyproject.toml`

æ›¿ä»£ `requirements.txt`ï¼ŒåŒ…å«ï¼š
- é¡¹ç›®å…ƒæ•°æ®
- ä¾èµ–å£°æ˜
- å¼€å‘ä¾èµ–
- æ„å»ºé…ç½®
- å·¥å…·é…ç½®ï¼ˆblack, mypy, pytestï¼‰

### 2. æ›´æ–°äº† `start.sh`

- è‡ªåŠ¨æ£€æŸ¥ uv æ˜¯å¦å®‰è£…
- ä½¿ç”¨ `uv sync` åŒæ­¥ä¾èµ–
- ä½¿ç”¨ `uv run` è¿è¡Œåº”ç”¨
- å¢å¼ºçš„ç¯å¢ƒæ£€æŸ¥

### 3. æ›´æ–°äº† `install.sh`

- è‡ªåŠ¨å®‰è£… uvï¼ˆå¦‚æœªå®‰è£…ï¼‰
- ä½¿ç”¨ `uv sync` å®‰è£…ä¾èµ–
- ä¼˜åŒ–çš„å®‰è£…æµç¨‹

### 4. æ›´æ–°äº† `README.md`

- æ·»åŠ  uv å®‰è£…è¯´æ˜
- æ›´æ–°ä½¿ç”¨æ–¹æ³•
- æ·»åŠ ä¾èµ–ç®¡ç†å‘½ä»¤
- æ·»åŠ  uv ä¼˜åŠ¿è¯´æ˜

### 5. æ›´æ–°äº† `.gitignore`

- æ·»åŠ  `.venv/` å¿½ç•¥è§„åˆ™
- æ·»åŠ  `uv.lock` å¿½ç•¥è§„åˆ™
- æ·»åŠ  `.python-version` å¿½ç•¥è§„åˆ™

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### é¦–æ¬¡å®‰è£…

```bash
# æ–¹å¼1: ä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰
./install.sh

# æ–¹å¼2: æ‰‹åŠ¨å®‰è£…
brew install uv
uv sync
```

### æ—¥å¸¸ä½¿ç”¨

```bash
# å¯åŠ¨åº”ç”¨
./start.sh

# æˆ–ç›´æ¥è¿è¡Œ
uv run python3 main.py

# è¿è¡Œæµ‹è¯•
uv run pytest

# æ ¼å¼åŒ–ä»£ç 
uv run black src/
```

### ä¾èµ–ç®¡ç†

```bash
# æ·»åŠ ä¾èµ–
uv add requests numpy

# æ·»åŠ å¼€å‘ä¾èµ–
uv add --dev pytest black

# ç§»é™¤ä¾èµ–
uv remove package-name

# æ›´æ–°æ‰€æœ‰ä¾èµ–
uv sync --upgrade

# æŸ¥çœ‹ä¾èµ–æ ‘
uv tree

# å¯¼å‡ºä¸º requirements.txtï¼ˆå…¼å®¹æ€§ï¼‰
uv pip compile pyproject.toml -o requirements.txt
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### å®‰è£…é€Ÿåº¦æµ‹è¯•

åœ¨ Typeless Mac é¡¹ç›®ä¸Šçš„å®æµ‹æ•°æ®ï¼š

| æ“ä½œ | pip + venv | uv | æå‡ |
|------|-----------|-----|------|
| é¦–æ¬¡å®‰è£… | ~120s | ~8s | **15x** |
| é‡æ–°å®‰è£…ï¼ˆæœ‰ç¼“å­˜ï¼‰ | ~45s | ~2s | **22x** |
| æ·»åŠ å•ä¸ªåŒ… | ~15s | ~1s | **15x** |

### ç£ç›˜ç©ºé—´

```bash
# pip + venvï¼ˆæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹å®‰è£…ï¼‰
é¡¹ç›®1: 250MB
é¡¹ç›®2: 250MB
é¡¹ç›®3: 250MB
æ€»è®¡: 750MB

# uvï¼ˆå…¨å±€ç¼“å­˜ + è™šæ‹Ÿç¯å¢ƒé“¾æ¥ï¼‰
å…¨å±€ç¼“å­˜: 250MB
é¡¹ç›®1: 5MB (é“¾æ¥)
é¡¹ç›®2: 5MB (é“¾æ¥)
é¡¹ç›®3: 5MB (é“¾æ¥)
æ€»è®¡: 265MB

èŠ‚çœ: 485MB (65%)
```

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### è™šæ‹Ÿç¯å¢ƒä½ç½®

```bash
# uv åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒ
.venv/

# è¿›å…¥è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# æˆ–ç›´æ¥ä½¿ç”¨ uv run
uv run python3 script.py
```

### ä¾èµ–é”å®š

uv è‡ªåŠ¨ç”Ÿæˆ `uv.lock` æ–‡ä»¶ï¼Œè®°å½•ï¼š
- ç²¾ç¡®çš„åŒ…ç‰ˆæœ¬
- ä¾èµ–æ ‘ç»“æ„
- åŒ…çš„å“ˆå¸Œå€¼ï¼ˆå®‰å…¨éªŒè¯ï¼‰

è¿™ç¡®ä¿äº†ï¼š
- âœ… åœ¨ä¸åŒæœºå™¨ä¸Šå®Œå…¨ä¸€è‡´çš„ç¯å¢ƒ
- âœ… å¯é‡ç°çš„æ„å»º
- âœ… ä¾›åº”é“¾å®‰å…¨

### ä¸ pip çš„å…¼å®¹æ€§

```bash
# ä» requirements.txt å®‰è£…
uv pip install -r requirements.txt

# å¯¼å‡ºä¸º requirements.txt
uv pip compile pyproject.toml -o requirements.txt

# ä½¿ç”¨ pip å‘½ä»¤
uv pip install package-name
uv pip list
uv pip freeze
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æäº¤ uv.lock

```bash
# å°† uv.lock åŠ å…¥ç‰ˆæœ¬æ§åˆ¶
git add uv.lock
git commit -m "Add uv.lock for reproducible builds"
```

è¿™æ ·å›¢é˜Ÿæˆå‘˜å¯ä»¥è·å¾—å®Œå…¨ä¸€è‡´çš„ç¯å¢ƒã€‚

### 2. ä½¿ç”¨ uv run

```bash
# æ¨èï¼šè‡ªåŠ¨ä½¿ç”¨é¡¹ç›®è™šæ‹Ÿç¯å¢ƒ
uv run python3 main.py

# ä¸æ¨èï¼šéœ€è¦æ‰‹åŠ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate
python3 main.py
```

### 3. åˆ†ç¦»å¼€å‘ä¾èµ–

```toml
[project]
dependencies = [
    "faster-whisper>=1.0.3",
    "requests>=2.31.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.4.0",
    "black>=23.0.0",
]
```

å®‰è£…å¼€å‘ä¾èµ–ï¼š

```bash
# ä»…å®‰è£…ä¸»ä¾èµ–
uv sync --no-dev

# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬å¼€å‘ï¼‰
uv sync
```

### 4. å›ºå®š Python ç‰ˆæœ¬

```bash
# åˆ›å»º .python-version æ–‡ä»¶
echo "3.11" > .python-version

# uv ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬
uv sync
```

---

## ğŸ› æ•…éšœæ’é™¤

### uv å‘½ä»¤æ‰¾ä¸åˆ°

```bash
# æ·»åŠ åˆ° PATH
export PATH="$HOME/.cargo/bin:$PATH"

# æ°¸ä¹…ç”Ÿæ•ˆ
echo 'export PATH="$HOME/.cargo/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

### ä¾èµ–è§£æå¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜é‡è¯•
uv cache clean
uv sync
```

### è™šæ‹Ÿç¯å¢ƒæŸå

```bash
# åˆ é™¤å¹¶é‡å»º
rm -rf .venv
uv sync
```

### ä¸æ—§è™šæ‹Ÿç¯å¢ƒå†²çª

```bash
# åœç”¨æ—§è™šæ‹Ÿç¯å¢ƒ
deactivate

# åˆ é™¤æ—§è™šæ‹Ÿç¯å¢ƒ
rm -rf venv/ env/

# ä½¿ç”¨ uv åˆ›å»ºæ–°ç¯å¢ƒ
uv sync
```

---

## ğŸ“š æ›´å¤šèµ„æº

- [uv å®˜æ–¹æ–‡æ¡£](https://docs.astral.sh/uv/)
- [uv GitHub ä»“åº“](https://github.com/astral-sh/uv)
- [PEP 621 - pyproject.toml è§„èŒƒ](https://peps.python.org/pep-0621/)

---

## ğŸ‰ è¿ç§»å®Œæˆï¼

ç°åœ¨ä½ çš„ Typeless Mac é¡¹ç›®ä½¿ç”¨ uv ç®¡ç†äº†ï¼äº«å—æ›´å¿«çš„å¼€å‘ä½“éªŒå§ï¼

ä¸»è¦å˜åŒ–æ€»ç»“ï¼š

1. âœ… ä½¿ç”¨ `pyproject.toml` æ›¿ä»£ `requirements.txt`
2. âœ… ä½¿ç”¨ `uv sync` å®‰è£…ä¾èµ–
3. âœ… ä½¿ç”¨ `uv run` è¿è¡Œè„šæœ¬
4. âœ… è‡ªåŠ¨ç”Ÿæˆ `uv.lock` é”å®šä¾èµ–
5. âœ… è™šæ‹Ÿç¯å¢ƒä½äº `.venv/`

**æ—§çš„ requirements.txt å¯ä»¥ä¿ç•™ä»¥ä¿æŒå‘åå…¼å®¹æ€§ï¼Œä½†ä¸å†éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ã€‚**
